---
- name: Install Git and Clone Repository
  hosts: server1
  become: yes  # This ensures the tasks run with sudo privileges
  tasks:
    - name: Ensure git is installed
      apt:
        name: git
        state: present
        update_cache: yes
    - name: Ensure Python 3.9 or higher is installed
      apt:
        name: "{{ item }}"
        state: present
      loop:
        - python3
        - python3.9
        - python3-pip

    - name: Check Python version
      command: python3 --version
      register: python_version

    - name: Fail if Python version is less than 3.9
      fail:
        msg: "Python version is less than 3.9. Required version is 3.9 or higher."
      when: python_version.stdout is version('3.9', '<')

    - name: Install pip3 if not present
      apt:
        name: python3-pip
        state: present

    - name: Install Jupyter Notebook
      pip:
        name: jupyter
        state: present
        executable: pip3


    - name: Clone the public GitHub repository
      git:
        repo: 'https://github.com/Semantics-of-Sustainability/tempo-embeddings.git'
        dest: /scratch/
        update: yes
    - name: Change directory and install Python package
      shell: |
        cd /scratch/tempo-embeddings
        python3 -m pip install .
      args:
        chdir: /scratch/tempo-embeddings

    - name: Print completion message
      debug:
        msg: "Repository cloned and Python package installed successfully."


